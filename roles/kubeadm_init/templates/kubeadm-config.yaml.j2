apiVersion: kubeadm.k8s.io/v1beta4
kind: ClusterConfiguration
kubernetesVersion: v{{ kubernetes_version }}
clusterName: airgap
imageRepository: {{ registry_addr }}

# YENİ: Tüm control-plane node'larının bağlanacağı sabit endpoint
# Bunu group_vars/all.yml içinde tanımladığımız LB ile eşliyoruz:
# apiserver_lb_host: "k8s-lb"
# apiserver_lb_port: 6443
controlPlaneEndpoint: "{{ apiserver_lb_host }}:{{ apiserver_lb_port }}"

networking:
  podSubnet: {{ pod_cidr }}
  serviceSubnet: {{ service_cidr }}

---
# YENİ: InitConfiguration ile containerd soketini kubeadm'e söylüyoruz
apiVersion: kubeadm.k8s.io/v1beta4
kind: InitConfiguration
nodeRegistration:
  criSocket: "unix:///run/containerd/containerd.sock"

---
apiVersion: kubelet.config.k8s.io/v1beta1
kind: KubeletConfiguration
cgroupDriver: "systemd"
