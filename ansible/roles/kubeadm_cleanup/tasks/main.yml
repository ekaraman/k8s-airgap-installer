---
# tasks file for kubeadm_cleanup

# roles/kubeadm_cleanup/tasks/main.yml
- name: Stop kubelet
  service:
    name: kubelet
    state: stopped
  ignore_errors: true

- name: kubeadm reset
  command: kubeadm reset -f
  ignore_errors: true

- name: Remove static pod manifests
  file:
    path: /etc/kubernetes/manifests
    state: absent

- name: Remove kubeadm conf files
  file:
    path: /etc/kubernetes
    state: absent

# ETCD sadece ilk masterâ€™da silinsin (stacked etcd senaryosu)
- name: Remove etcd data on first control-plane
  file:
    path: /var/lib/etcd
    state: absent
  when: inventory_hostname == groups['master'][0]

- name: Remove old root kubeconfig
  file:
    path: /root/.kube/config
    state: absent

- name: Flush iptables (optional ama iyi olur)
  command: iptables -F
  ignore_errors: true

