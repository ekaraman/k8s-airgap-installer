version = 2

[plugins]
  [plugins."io.containerd.grpc.v1.cri"]
    # Kubelet'in sandbox (pause) imajı
    sandbox_image = "registry.k8s.io/pause:3.10"

    [plugins."io.containerd.grpc.v1.cri".containerd]
      snapshotter = "overlayfs"

    [plugins."io.containerd.grpc.v1.cri".registry]
      [plugins."io.containerd.grpc.v1.cri".registry.mirrors]
        # Bastion üzerindeki local HTTP registry
        [plugins."io.containerd.grpc.v1.cri".registry.mirrors."{{ registry_host }}:{{ registry_port }}"]
          endpoint = ["http://{{ registry_host }}:{{ registry_port }}"]

        # registry.k8s.io isteklerini local registry'e yönlendir
        [plugins."io.containerd.grpc.v1.cri".registry.mirrors."registry.k8s.io"]
          endpoint = ["http://{{ registry_host }}:{{ registry_port }}"]

      # Eğer ileride HTTPS + self-signed TLS kullanırsan burayı açarsın
      # [plugins."io.containerd.grpc.v1.cri".registry.configs."{{ registry_host }}:{{ registry_port }}".tls]
      #   insecure_skip_verify = true

